#!/usr/bin/env python3
import sqlite3
import os
import sys

def get_db_path():
    """データベースファイルのパスを取得"""
    # 環境変数DB_PATHが設定されていればそれを使用（Docker用）
    db_path = os.environ.get('DB_PATH')
    if db_path:
        return db_path
    # 環境変数がなければデフォルトのパス（プロジェクトルート）
    script_dir = os.path.dirname(os.path.abspath(__file__))
    project_root = os.path.dirname(script_dir)
    return os.path.join(project_root, 'data', 'tourism_review.db')

def add_tourist_spots():
    """群馬県の観光地マスターに初期データを追加"""

    # データベースに接続
    db_path = get_db_path()
    conn = sqlite3.connect(db_path)
    cursor = conn.cursor()

    # 群馬県の観光地データ
    tourist_spots = [
        # 温泉地
        ('草津温泉', '群馬県吾妻郡草津町草津', 'JR長野原草津口駅からバス25分', '24時間（施設により異なる）', '施設により異なる', 'https://maps.google.com/?q=草津温泉', '日本三名泉の一つ。湯畑を中心に温泉街が広がる。'),
        ('伊香保温泉', '群馬県渋川市伊香保町', 'JR渋川駅からバス25分', '24時間（施設により異なる）', '施設により異なる', 'https://maps.google.com/?q=伊香保温泉', '石段街で有名な温泉地。黄金の湯と白銀の湯の2種類の源泉がある。'),
        ('万座温泉', '群馬県吾妻郡嬬恋村万座温泉', 'JR万座・鹿沢口駅からバス40分', '施設により異なる', '施設により異なる', 'https://maps.google.com/?q=万座温泉', '標高1,800mに位置する高山温泉。乳白色の硫黄泉が特徴。'),
        ('四万温泉', '群馬県吾妻郡中之条町四万', 'JR中之条駅からバス40分', '24時間（施設により異なる）', '施設により異なる', 'https://maps.google.com/?q=四万温泉', '四万の病に効くといわれる温泉。レトロな温泉街の雰囲気が魅力。'),
        ('水上温泉', '群馬県利根郡みなかみ町', 'JR水上駅から徒歩圏内', '施設により異なる', '施設により異なる', 'https://maps.google.com/?q=水上温泉', '利根川上流の渓谷美が楽しめる温泉地。'),

        # 自然・景勝地
        ('尾瀬', '群馬県利根郡片品村', '沼田ICから鳩待峠まで車で約1時間半', '5月中旬〜10月下旬', '無料（山小屋宿泊は有料）', 'https://maps.google.com/?q=尾瀬', '本州最大の高層湿原。ミズバショウやニッコウキスゲの群生地。'),
        ('吹割の滝', '群馬県沼田市利根町追貝', 'JR沼田駅からバス40分', '見学自由', '無料', 'https://maps.google.com/?q=吹割の滝', '東洋のナイアガラと呼ばれる幅30m、高さ7mの滝。'),
        ('榛名山・榛名湖', '群馬県高崎市榛名湖町', 'JR高崎駅からバス90分', '24時間（施設により異なる）', '無料（ロープウェイは有料）', 'https://maps.google.com/?q=榛名湖', '標高1,100mのカルデラ湖。ボート遊びや登山が楽しめる。'),
        ('赤城山', '群馬県前橋市富士見町赤城山', 'JR前橋駅からバス70分', '24時間', '無料', 'https://maps.google.com/?q=赤城山', '上毛三山の一つ。大沼・小沼の湖畔散策が人気。'),
        ('妙義山', '群馬県富岡市妙義町', 'JR松井田駅からバス10分', '24時間', '無料', 'https://maps.google.com/?q=妙義山', '奇岩怪石の山。日本三奇勝の一つ。'),

        # 世界遺産
        ('富岡製糸場', '群馬県富岡市富岡1-1', 'JR高崎駅から上信電鉄で40分、上州富岡駅から徒歩15分', '9:00-17:00', '大人1,000円', 'https://maps.google.com/?q=富岡製糸場', '世界遺産。明治時代の官営製糸工場。'),

        # テーマパーク・観光施設
        ('群馬サファリパーク', '群馬県富岡市岡本1', 'JR高崎駅から車で40分', '9:30-16:00（11月-2月）、9:30-17:00（3月-10月）', '大人2,700円', 'https://maps.google.com/?q=群馬サファリパーク', '車やバスで園内を回る体験型動物園。'),
        ('伊香保グリーン牧場', '群馬県渋川市金井2844', 'JR渋川駅からバス15分', '9:00-16:00（季節により変動）', '大人1,500円', 'https://maps.google.com/?q=伊香保グリーン牧場', 'シープドッグショーや動物とのふれあいが楽しめる。'),
        ('軽井沢おもちゃ王国', '群馬県吾妻郡嬬恋村大前細原2277', '軽井沢駅から送迎バス60分', '10:00-17:00（季節により変動）', '大人1,200円', 'https://maps.google.com/?q=軽井沢おもちゃ王国', '子供向けテーマパーク。おもちゃの部屋や自然体験が充実。'),

        # 歴史・文化施設
        ('こんにゃくパーク', '群馬県甘楽郡甘楽町小幡204-1', 'JR高崎駅から車で30分', '9:00-18:00', '無料', 'https://maps.google.com/?q=こんにゃくパーク', 'こんにゃくの工場見学と試食バイキングが楽しめる。'),
        ('ロックハート城', '群馬県吾妻郡高山村中山5583-1', 'JR沼田駅から車で20分', '9:00-17:00', '大人1,100円', 'https://maps.google.com/?q=ロックハート城', 'スコットランドから移築された本物の古城。'),
        ('碓氷峠鉄道文化むら', '群馬県安中市松井田町横川407-16', 'JR横川駅から徒歩3分', '9:00-17:00（11月-2月は16:30まで）', '大人500円', 'https://maps.google.com/?q=碓氷峠鉄道文化むら', '鉄道の歴史を学べる博物館。トロッコ列車も運行。'),

        # 花の名所
        ('ぐんまフラワーパーク', '群馬県前橋市柏倉町2471-7', 'JR前橋駅からバス30分', '9:00-17:00（季節により変動）', '大人700円', 'https://maps.google.com/?q=ぐんまフラワーパーク', '四季折々の花が楽しめる。イルミネーションも人気。'),
        ('たんばらラベンダーパーク', '群馬県沼田市玉原高原', 'JR沼田駅から車で40分', '8:30-17:00（7月-8月）', '大人1,000円', 'https://maps.google.com/?q=たんばらラベンダーパーク', '関東最大級5万株のラベンダー園。'),

        # アクティビティ
        ('谷川岳ロープウェイ', '群馬県利根郡みなかみ町湯檜曽', 'JR水上駅からバス20分', '8:00-17:00（季節により変動）', '往復大人2,100円', 'https://maps.google.com/?q=谷川岳ロープウェイ', '標高1,319mまで一気に上昇。天神平からの眺望が素晴らしい。'),
        ('鬼押出し園', '群馬県吾妻郡嬬恋村鎌原', '軽井沢駅からバス40分', '8:00-17:00', '大人650円', 'https://maps.google.com/?q=鬼押出し園', '浅間山の噴火でできた溶岩の奇観。'),
    ]

    # データを挿入
    try:
        cursor.executemany(
            '''INSERT INTO tourist_spots
               (spot_name, address, access, business_hours, fee, map_url, description)
               VALUES (?, ?, ?, ?, ?, ?, ?)''',
            tourist_spots
        )
        conn.commit()
        print(f"✅ {len(tourist_spots)}件の群馬県観光地データを追加しました！")

        # 追加後の全データ数を確認
        cursor.execute('SELECT COUNT(*) FROM tourist_spots')
        total_count = cursor.fetchone()[0]
        print(f"📊 観光地マスターの総データ数: {total_count}件")

        # 追加したデータの一部を表示
        print("\n追加した群馬県の観光地（一部）:")
        cursor.execute('SELECT spot_id, spot_name, address FROM tourist_spots ORDER BY spot_id DESC LIMIT 10')
        for row in cursor.fetchall():
            print(f"  ID: {row[0]:3d} | {row[1]:20s} | {row[2][:40]}...")

    except sqlite3.IntegrityError as e:
        print(f"❌ エラー: データの重複があります。{e}")
    except Exception as e:
        print(f"❌ エラーが発生しました: {e}")
    finally:
        conn.close()

if __name__ == '__main__':
    add_tourist_spots()